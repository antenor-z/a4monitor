<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/static/style.css">

    <title>A4 Monitor</title>
</head>

<body>
    <content>
        <h1>A4 Monitor</h1>
        <p id="checkStatus" class="status-box green-box">checking...</p>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="statusTable"></tbody>
        </table>

        <script>
            async function loadStatus() {
                checkStatus.innerText = "checking..."
                const res = await fetch('/api/status')
                const data = await res.json()
                const tbody = document.getElementById('statusTable')
                tbody.innerHTML = ""
                data.results.forEach(item => {
                    const row = document.createElement('tr')
                    let status = item.status
                    if (status === "operational") {
                        status = "<span class='operational-status'>operational</span>"
                    }
                    else {
                        status = `<span class='failed-status'>${status}</span>`
                    }
                    row.innerHTML = `<td class="flexible">${item.name}</td><td class="fixed">${status}</td>`
                    tbody.appendChild(row)
                })

                if (data.allSystemsOk) {
                    checkStatus.innerText = "All systems OK";
                    checkStatus.className = "status-box green-box";
                } else {
                    checkStatus.innerText = "Some systems failed";
                    checkStatus.className = "status-box red-box";
                }
            }
            loadStatus();
            setInterval(loadStatus, 10000)
        </script>
    </content>
</body>

</html>
